@using System.Text.Json

@{
    ViewData["Title"] = "Home Page";
}


<div class="text-center">
    <h1 class="p1">Welcome to Epitomel Hotel</h1>

    
    <div id="HotelImages" class="carousel slide carousel-fade mb-5" data-bs-ride="carousel" style="max-width: 1000px; margin: auto;">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#HotelImages" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#HotelImages" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#HotelImages" data-bs-slide-to="2"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="/Images/pol.jpeg" class="d-block w-100" alt="Pool">
            </div>
            <div class="carousel-item">
                <img src="/Images/garden.jpg" class="d-block w-100" alt="Garden">
            </div>
            <div class="carousel-item">
                <img src="/Images/lounge.jpeg" class="d-block w-100" alt="Lounge">
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#HotelImages" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#HotelImages" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <div class="container mb-5">
        <div class="booking-form row justify-content-center">

            <!-- Price Info -->
            <div class="col-12 text-center mb-3">
                <p class="fw-bold text-white">$75 per day (added to the room price)</p>
            </div>

            <form id="bookingForm" method="post" asp-controller="Bookings" asp-action="StartCreate" class="row">
                @Html.AntiForgeryToken()

                <!-- Check-In Date -->
                <div class="col-md-3">
                    <label for="checkIn" class="form-label">Check-in Date</label>
                    <input type="text" id="checkIn" name="checkIn" class="form-control" required />
                    <span id="checkin-error" class="text-danger"></span>
                </div>

                <!-- Check-Out Date -->
                <div class="col-md-3">
                    <label for="checkOut" class="form-label">Check-out Date</label>
                    <input type="text" id="checkOut" name="checkOut" class="form-control" required />
                    <span id="checkout-error" class="text-danger"></span>
                </div>

                <!-- Room Selection -->
                <div class="col-md-3">
                    <label for="roomId" class="form-label">Room</label>
                    <select id="roomId" name="roomId" class="form-select" required>
                        <option value="">Select Room</option>
                        <option value="1">Single $100.00</option>
                        <option value="2">Double $150.00</option>
                        <option value="3">Deluxe $180.00</option>
                        <option value="4">Suite $250.00</option>
                        <option value="5">Family $220.00</option>
                        <option value="6">Penthouse $400.00</option>
                    </select>
                </div>

                <!-- Submit Button -->
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Book Now</button>
                </div>
            </form>
        </div>
    </div>


    
    <div class="container features-section">
        <div class="row justify-content-center">
            <div class="card custom-card mx-3 card-hover" style="width: 30rem;">
                <a asp-controller="Rooms" asp-action="Index">
                    <img src="~/Images/Rooms.jpg" class="card-img-top custom-img" alt="Rooms">
                </a>
                <div class="card-body">
                    <h5 class="card-title text-dark">Rooms</h5>
                    <p class="card-text text-dark">Explore our variety of room types suited to your comfort and budget.</p>
                </div>
            </div>
                <div class="card custom-card mx-3 card-hover" style="width: 30rem;">

                <a asp-controller="Services" asp-action="Index">
                    <img src="~/Images/bar.jpg" class="card-img-top custom-img" alt="Services">
                </a>
                <div class="card-body">
                    <h5 class="card-title text-dark">Services</h5>
                    <p class="card-text text-dark">Discover the premium services available to enhance your stay.</p>
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        const unavailableDates = @Html.Raw(Json.Serialize(ViewBag.UnavailableDates ?? new List<string>()));

        // Initialize checkout picker first (needed for reference)
        const checkOutPicker = flatpickr("#checkOut", {
            minDate: "today",
            disable: unavailableDates,
            dateFormat: "Y-m-d"
        });

        // Initialize checkin picker with logic to set checkout min date
        flatpickr("#checkIn", {
            minDate: "today",
            disable: unavailableDates,
            dateFormat: "Y-m-d",
            onChange: function (selectedDates) {
                if (selectedDates.length > 0) {
                    const nextDay = new Date(selectedDates[0]);
                    nextDay.setDate(nextDay.getDate() + 1);
                    checkOutPicker.set("minDate", nextDay);

                    // Auto-reset checkout if it's invalid
                    const currentCheckOut = checkOutPicker.selectedDates[0];
                    if (!currentCheckOut || currentCheckOut < nextDay) {
                        checkOutPicker.setDate(nextDay, true);
                    }
                }
            }
        });
    </script>
}


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("bookingForm");
        const checkInInput = document.getElementById("checkIn");
        const checkOutInput = document.getElementById("checkOut");
        const checkOutError = document.getElementById("checkout-error");

        // Create a check-in error span (just once)
        let checkInError = document.getElementById("checkin-error");
        if (!checkInError) {
            checkInError = document.createElement("span");
            checkInError.id = "checkin-error";
            checkInError.classList.add("text-danger");
            checkInInput.parentNode.appendChild(checkInError);
        }

        function validateDates() {
            let isValid = true;
            checkInError.innerText = "";
            checkOutError.innerText = "";

            if (!checkInInput.value) {
                checkInError.innerText = "Please select a check-in date.";
                isValid = false;
            }

            if (!checkOutInput.value) {
                checkOutError.innerText = "Please select a check-out date.";
                isValid = false;
            }

            if (checkInInput.value && checkOutInput.value) {
                const checkIn = new Date(checkInInput.value);
                const checkOut = new Date(checkOutInput.value);
                if (checkOut <= checkIn) {
                    checkOutInput.setCustomValidity("Check-out must be after check-in.");
                    checkOutError.innerText = "Check-out must be after check-in.";
                    isValid = false;
                } else {
                    checkOutInput.setCustomValidity("");
                }
            }

            return isValid;
        }

        checkInInput.addEventListener("change", validateDates);
        checkOutInput.addEventListener("change", validateDates);

        form.addEventListener("submit", function (e) {
            if (!validateDates()) {
                e.preventDefault(); // Prevent form from submitting
            }
        });
    });
</script>


